\hypertarget{buffered__serial_8h}{}\doxysection{buffered\+\_\+serial.\+h File Reference}
\label{buffered__serial_8h}\index{buffered\_serial.h@{buffered\_serial.h}}


Serial communication based on a circular buffer, dma and huart with hal controls and Static Strings.  


{\ttfamily \#include \char`\"{}stm32f1xx\+\_\+hal.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}stm32f1xx\+\_\+hal\+\_\+uart.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}static\+\_\+strings.\+h\char`\"{}}\newline
\doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}}
\begin{DoxyCompactList}\small\item\em Meta data of a buffered serial. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define {\bfseries B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+S\+E\+R\+I\+A\+L\+S\+\_\+\+Q\+U\+A\+N\+T\+I\+TY}~1
\item 
\#define {\bfseries B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+B\+U\+F\+F\+E\+R\+S\+\_\+\+S\+I\+ZE}~500
\item 
\#define {\bfseries B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+\+S\+T\+A\+T\+I\+C\+\_\+\+S\+T\+R\+I\+N\+G\+S\+\_\+\+E\+R\+R\+OR}~0
\item 
\#define {\bfseries B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+E\+R\+R\+O\+R\+\_\+\+C\+O\+D\+E\+\_\+\+N\+O\+\_\+\+L\+I\+N\+E\+\_\+\+E\+N\+D\+I\+N\+G\+\_\+\+D\+E\+T\+E\+C\+T\+ED}~1
\end{DoxyCompactItemize}
\doxysubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{buffered__serial_8h_a67fa2317c5242dd4778b3c5aee517155}\label{buffered__serial_8h_a67fa2317c5242dd4778b3c5aee517155}} 
typedef struct \mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} {\bfseries buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{buffered__serial_8h_a932ac0c10c65aeaa78c96188842bf0b4}{buffered\+\_\+serial\+\_\+init}} (U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$$\ast$huarts)
\begin{DoxyCompactList}\small\item\em Link huarts and buffers with serial descriptors and init rx data receiving and idle interrupt. Also init the Static Strings library. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$ \mbox{\hyperlink{buffered__serial_8h_a82298a570a1b7f5d4a74b5b60b36dce1}{buffered\+\_\+serial\+\_\+get\+\_\+huart\+\_\+serial\+\_\+descriptor}} (U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$huart)
\begin{DoxyCompactList}\small\item\em Returns the serial\+\_\+descriptor of the provided huart. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{buffered__serial_8h_a0e3c19f2a6c72c3073ae12badfdb4e21}{buffered\+\_\+serial\+\_\+available}} (\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$serial)
\begin{DoxyCompactList}\small\item\em Calculates and returns the number of characters that can be read from the rx buffer. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{buffered__serial_8h_af9f239a3911da64fee87093df8bf360e}{buffered\+\_\+serial\+\_\+print\+\_\+string}} (\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$serial, static\+\_\+strings\+\_\+string\+\_\+descriptor $\ast$string\+\_\+descriptor)
\begin{DoxyCompactList}\small\item\em Transmit a string with the specific huart in the serial descriptor. Strings larger than B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+B\+U\+F\+F\+E\+R\+S\+\_\+\+S\+I\+ZE will be transmitted in blocks of that size. \end{DoxyCompactList}\item 
static\+\_\+strings\+\_\+string\+\_\+descriptor $\ast$ \mbox{\hyperlink{buffered__serial_8h_a616e9a5064971acf1001fb461c727d77}{buffered\+\_\+serial\+\_\+read\+\_\+line}} (\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$serial)
\begin{DoxyCompactList}\small\item\em Read a string in the specific huart buffer in the serial descriptor. String must have \textbackslash{}r\textbackslash{}n line ending. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{buffered__serial_8h_a1eaf9bea7e2cffbaddb95999f1709fc2}{buffered\+\_\+serial\+\_\+update\+\_\+rx\+\_\+buffer\+\_\+data}} (U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$huart)
\begin{DoxyCompactList}\small\item\em When I\+D\+LE line interruption is fired this function updates the rx buffer meta data. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \mbox{\hyperlink{group__error__handling_gad287e746856213bf13293b3fa8153277}{buffered\+\_\+serial\+\_\+error\+\_\+code}}
\begin{DoxyCompactList}\small\item\em Global variable to store error code. \end{DoxyCompactList}\item 
uint8\+\_\+t {\bfseries buffered\+\_\+serial\+\_\+rx\+\_\+buffers} \mbox{[}B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+S\+E\+R\+I\+A\+L\+S\+\_\+\+Q\+U\+A\+N\+T\+I\+TY\mbox{]}\mbox{[}B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+B\+U\+F\+F\+E\+R\+S\+\_\+\+S\+I\+ZE\mbox{]}
\item 
uint8\+\_\+t {\bfseries buffered\+\_\+serial\+\_\+tx\+\_\+buffers} \mbox{[}B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+S\+E\+R\+I\+A\+L\+S\+\_\+\+Q\+U\+A\+N\+T\+I\+TY\mbox{]}\mbox{[}B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+B\+U\+F\+F\+E\+R\+S\+\_\+\+S\+I\+ZE\mbox{]}
\item 
\mbox{\Hypertarget{buffered__serial_8h_aafb545a295b14e8a2b78b40813f32d6b}\label{buffered__serial_8h_aafb545a295b14e8a2b78b40813f32d6b}} 
\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} {\bfseries buffered\+\_\+serial\+\_\+serial\+\_\+descriptors} \mbox{[}B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+S\+E\+R\+I\+A\+L\+S\+\_\+\+Q\+U\+A\+N\+T\+I\+TY\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Serial communication based on a circular buffer, dma and huart with hal controls and Static Strings. 



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{buffered__serial_8h_a0e3c19f2a6c72c3073ae12badfdb4e21}\label{buffered__serial_8h_a0e3c19f2a6c72c3073ae12badfdb4e21}} 
\index{buffered\_serial.h@{buffered\_serial.h}!buffered\_serial\_available@{buffered\_serial\_available}}
\index{buffered\_serial\_available@{buffered\_serial\_available}!buffered\_serial.h@{buffered\_serial.h}}
\doxysubsubsection{\texorpdfstring{buffered\_serial\_available()}{buffered\_serial\_available()}}
{\footnotesize\ttfamily uint16\+\_\+t buffered\+\_\+serial\+\_\+available (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$}]{serial }\end{DoxyParamCaption})}



Calculates and returns the number of characters that can be read from the rx buffer. 

uint16\+\_\+t \mbox{\hyperlink{buffered__serial_8h_a0e3c19f2a6c72c3073ae12badfdb4e21}{buffered\+\_\+serial\+\_\+available(buffered\+\_\+serial\+\_\+serial\+\_\+descriptor $\ast$serial)}} 
\begin{DoxyParams}{Parameters}
{\em serial} & Pointer to the serial descriptor of the target huart. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Number of characters that can be read from the rx buffer. 
\end{DoxyReturn}
\mbox{\Hypertarget{buffered__serial_8h_a82298a570a1b7f5d4a74b5b60b36dce1}\label{buffered__serial_8h_a82298a570a1b7f5d4a74b5b60b36dce1}} 
\index{buffered\_serial.h@{buffered\_serial.h}!buffered\_serial\_get\_huart\_serial\_descriptor@{buffered\_serial\_get\_huart\_serial\_descriptor}}
\index{buffered\_serial\_get\_huart\_serial\_descriptor@{buffered\_serial\_get\_huart\_serial\_descriptor}!buffered\_serial.h@{buffered\_serial.h}}
\doxysubsubsection{\texorpdfstring{buffered\_serial\_get\_huart\_serial\_descriptor()}{buffered\_serial\_get\_huart\_serial\_descriptor()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}}$\ast$ buffered\+\_\+serial\+\_\+get\+\_\+huart\+\_\+serial\+\_\+descriptor (\begin{DoxyParamCaption}\item[{U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$}]{huart }\end{DoxyParamCaption})}



Returns the serial\+\_\+descriptor of the provided huart. 

\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} \mbox{\hyperlink{buffered__serial_8h_a82298a570a1b7f5d4a74b5b60b36dce1}{buffered\+\_\+serial\+\_\+get\+\_\+huart\+\_\+serial\+\_\+descriptor(\+U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$huart)}} 
\begin{DoxyParams}{Parameters}
{\em huart} & Pointer to a U\+A\+R\+T\+\_\+\+Handle\+Type\+Def. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A pointer to the serial descriptor of the provided huart. Return N\+U\+LL if there is no serial descriptor attached to the huart provided. 
\end{DoxyReturn}
\mbox{\Hypertarget{buffered__serial_8h_a932ac0c10c65aeaa78c96188842bf0b4}\label{buffered__serial_8h_a932ac0c10c65aeaa78c96188842bf0b4}} 
\index{buffered\_serial.h@{buffered\_serial.h}!buffered\_serial\_init@{buffered\_serial\_init}}
\index{buffered\_serial\_init@{buffered\_serial\_init}!buffered\_serial.h@{buffered\_serial.h}}
\doxysubsubsection{\texorpdfstring{buffered\_serial\_init()}{buffered\_serial\_init()}}
{\footnotesize\ttfamily void buffered\+\_\+serial\+\_\+init (\begin{DoxyParamCaption}\item[{U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$$\ast$}]{huarts }\end{DoxyParamCaption})}



Link huarts and buffers with serial descriptors and init rx data receiving and idle interrupt. Also init the Static Strings library. 

void \mbox{\hyperlink{buffered__serial_8h_a932ac0c10c65aeaa78c96188842bf0b4}{buffered\+\_\+serial\+\_\+init(\+U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$$\ast$huarts)}} 
\begin{DoxyParams}{Parameters}
{\em huarts} & Array of pointers to huart pointer. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{buffered__serial_8h_af9f239a3911da64fee87093df8bf360e}\label{buffered__serial_8h_af9f239a3911da64fee87093df8bf360e}} 
\index{buffered\_serial.h@{buffered\_serial.h}!buffered\_serial\_print\_string@{buffered\_serial\_print\_string}}
\index{buffered\_serial\_print\_string@{buffered\_serial\_print\_string}!buffered\_serial.h@{buffered\_serial.h}}
\doxysubsubsection{\texorpdfstring{buffered\_serial\_print\_string()}{buffered\_serial\_print\_string()}}
{\footnotesize\ttfamily void buffered\+\_\+serial\+\_\+print\+\_\+string (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$}]{serial,  }\item[{static\+\_\+strings\+\_\+string\+\_\+descriptor $\ast$}]{string\+\_\+descriptor }\end{DoxyParamCaption})}



Transmit a string with the specific huart in the serial descriptor. Strings larger than B\+U\+F\+F\+E\+R\+E\+D\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+B\+U\+F\+F\+E\+R\+S\+\_\+\+S\+I\+ZE will be transmitted in blocks of that size. 

void buffered\+\_\+serial\+\_\+print\+\_\+string(static\+\_\+strings\+\_\+string\+\_\+descriptor $\ast$string,buffered\+\_\+serial\+\_\+serial\+\_\+descriptor $\ast$serial) 
\begin{DoxyParams}{Parameters}
{\em string\+\_\+descriptor} & Pointer to the descriptor of the string to transmit. \\
\hline
{\em serial} & Pointer to the serial descriptor of the target huart. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{buffered__serial_8h_a616e9a5064971acf1001fb461c727d77}\label{buffered__serial_8h_a616e9a5064971acf1001fb461c727d77}} 
\index{buffered\_serial.h@{buffered\_serial.h}!buffered\_serial\_read\_line@{buffered\_serial\_read\_line}}
\index{buffered\_serial\_read\_line@{buffered\_serial\_read\_line}!buffered\_serial.h@{buffered\_serial.h}}
\doxysubsubsection{\texorpdfstring{buffered\_serial\_read\_line()}{buffered\_serial\_read\_line()}}
{\footnotesize\ttfamily static\+\_\+strings\+\_\+string\+\_\+descriptor$\ast$ buffered\+\_\+serial\+\_\+read\+\_\+line (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$}]{serial }\end{DoxyParamCaption})}



Read a string in the specific huart buffer in the serial descriptor. String must have \textbackslash{}r\textbackslash{}n line ending. 

static\+\_\+strings\+\_\+string\+\_\+descriptor $\ast$buffered\+\_\+serial\+\_\+read\+\_\+line(\mbox{\hyperlink{structbuffered__serial__serial__descriptor}{buffered\+\_\+serial\+\_\+serial\+\_\+descriptor}} $\ast$serial) 
\begin{DoxyParams}{Parameters}
{\em serial} & Pointer to the serial descriptor of the target huart. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the string descriptor of the line read (See library Static Strings), if N\+U\+LL check buffered\+\_\+serial\+\_\+error\+\_\+code. 
\end{DoxyReturn}
\mbox{\Hypertarget{buffered__serial_8h_a1eaf9bea7e2cffbaddb95999f1709fc2}\label{buffered__serial_8h_a1eaf9bea7e2cffbaddb95999f1709fc2}} 
\index{buffered\_serial.h@{buffered\_serial.h}!buffered\_serial\_update\_rx\_buffer\_data@{buffered\_serial\_update\_rx\_buffer\_data}}
\index{buffered\_serial\_update\_rx\_buffer\_data@{buffered\_serial\_update\_rx\_buffer\_data}!buffered\_serial.h@{buffered\_serial.h}}
\doxysubsubsection{\texorpdfstring{buffered\_serial\_update\_rx\_buffer\_data()}{buffered\_serial\_update\_rx\_buffer\_data()}}
{\footnotesize\ttfamily void buffered\+\_\+serial\+\_\+update\+\_\+rx\+\_\+buffer\+\_\+data (\begin{DoxyParamCaption}\item[{U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$}]{huart }\end{DoxyParamCaption})}



When I\+D\+LE line interruption is fired this function updates the rx buffer meta data. 

void \mbox{\hyperlink{buffered__serial_8h_a1eaf9bea7e2cffbaddb95999f1709fc2}{buffered\+\_\+serial\+\_\+update\+\_\+rx\+\_\+buffer\+\_\+data(\+U\+A\+R\+T\+\_\+\+Handle\+Type\+Def $\ast$huart)}} 
\begin{DoxyParams}{Parameters}
{\em Pointer} & to the huart I\+D\+LE line interruption source. \\
\hline
\end{DoxyParams}
